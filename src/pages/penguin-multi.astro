---
import Layout from "../layouts/Layout.astro";
---

<Layout title="TP4 – Penguins + filtres (3)">
  <h2 style="margin:0 0 1rem">Penguins — filtres espèce / île / sexe</h2>

  <div style="display:flex;gap:.75rem;flex-wrap:wrap;margin:.25rem 0 1rem">
    <label>Espèce
      <select id="species" style="margin-left:.35rem">
        <option value="">Toutes</option>
        <option value="Adelie">Adelie</option>
        <option value="Chinstrap">Chinstrap</option>
        <option value="Gentoo">Gentoo</option>
      </select>
    </label>

    <label>Île
      <select id="island" style="margin-left:.35rem">
        <option value="">Toutes</option>
        <option value="Biscoe">Biscoe</option>
        <option value="Dream">Dream</option>
        <option value="Torgersen">Torgersen</option>
      </select>
    </label>

    <label>Sexe
      <select id="sex" style="margin-left:.35rem">
        <option value="">Tous</option>
        <option value="MALE">MALE</option>
        <option value="FEMALE">FEMALE</option>
      </select>
    </label>
  </div>

  <div id="chart"></div>

  <script>
    import * as Plot from "@observablehq/plot";
    import penguins from "../assets/penguins.json";

    const $chart   = document.querySelector("#chart");
    const $species = document.querySelector("#species");
    const $island  = document.querySelector("#island");
    const $sex     = document.querySelector("#sex");

    function renderPlot() {
      let data = penguins;

      const s = $species.value;
      const i = $island.value;
      const sx = $sex.value;

      if (s)  data = data.filter(d => d.species === s);
      if (i)  data = data.filter(d => d.island  === i);
      if (sx) data = data.filter(d => d.sex     === sx);

      $chart.innerHTML = "";
      const plot = Plot.plot({
        width: 920,
        height: 500,
        x: { label: "Culmen length (mm)", grid: true },
        y: { label: "Culmen depth (mm)", grid: true },
        color: { legend: true },
        marks: [
          Plot.dot(data, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            stroke: "species",
            tip: true
          })
        ]
      });
      $chart.append(plot);
    }

    for (const el of [$species, $island, $sex]) el.addEventListener("change", renderPlot);
    renderPlot(); // initial
  </script>
</Layout>
